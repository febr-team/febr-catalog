--- 
title: "Repositório Brasileiro Livre para Dados Abertos do Solo"
subtitle: "Catálogo de Conjuntos de Dados"
author: "Equipe febr"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
lang: pt-br
# documentclass: book
# bibliography: [book.bib, packages.bib]
# biblio-style: apalike
# link-citations: yes
description: "Catálogo dos conjuntos de dados disponíveis no febr"
---

```{r, echo=FALSE}
library(magrittr)
library(pander)
library(glue)
library(febr)
library(sp)
library(mapview)
```

# Apresentação {-}


```{r, results='asis', echo=FALSE}
# dts <- datasets(progress = FALSE)
# save(dts, file = "data/dts.rda")
# obs <- observations(dataset = 'all', missing.coords = 'keep', stack.obs = FALSE)
# save(obs, file = "data/obs.rda")
load("data/dts.rda")
load("data/obs.rda")
j <- 1:10
dts <- dts[j]
obs <- obs[j]
for (i in 1:length(dts)) {
  i <- 1
  id <- dts[[i]][1, 2] %>% as.character()
  
  glue('# {id} {{-}}') %>% print()
  glue('## Descrição geral {{-}}') %>% print()

  dts[[i]][-1, ] %>%
    pandoc.table(split.tables = Inf, justify = 'left', col.names = c('campo', 'valor'), row.names = FALSE)
  
  glue('## Distribuição espacial {{-}}') %>% print()
  
  n_obs <- nrow(obs[[i]])
  n_coords <- length(!is.na(obs[[i]]$coord_x))
  if (n_coords != 0) {
    tmp <- obs[[i]]
    coordinates(tmp) <- ~ coord_x + coord_y
    proj4string(tmp) <- CRS("+init=epsg:4674")
    m <- mapview(tmp, label = tmp$observacao_id, col.regions = "firebrick1", lwd = 1, col = "ivory")@map
    if (n_coords != n_obs) {
      m <- glue("{n_obs - n_coords} observações do conjunto de dados {id} não possuem coordenadas espaciais.")
    }
  } else {
    glue("As observações do conjunto de dados {id} não possuem coordenadas espaciais.")
  }
  m
}
```
